.technology{id: "T#{technology.object_id}", class: technology_class(technology), data: technology_data(technology, node) }
  .advanced-actions.pull-right
    - if technology.technology.expandable?
      = link_to "#!", class: "btn btn-default btn-sm split" do
        Split
        %span.glyphicon.glyphicon-resize-full

    .btn-group
      = link_to "Toggle advanced", "#!", class: "btn btn-primary btn-sm show-advanced"
      = link_to "#!", class: "remove-row btn btn-danger btn-sm" do
        %span.glyphicon.glyphicon-trash

  - if technology.sticks_to_composite?
    .indent.arrow

  .wrapper-tech
    %strong
      = I18n.t("inputs.#{ technology.type }")
      = technology.name_adjective

    - if technology.whitelisted?('profile')
      .editable.profile.select
        %span Profile
        %select.profile.form-control{autocomplete: 'off', data: { type: 'profile' }}
          = options_for_load_profiles(technology.technology)

    - if technology.whitelisted?('buffer')
      .editable.buffer.select
        %span Buffer
        %select.buffer.form-control{autocomplete: 'off', data: { type: 'buffer' }}

    - if technology.whitelisted?('position_relative_to_buffer')
      .editable.position_relative_to_buffer
        %span Position technology

        - buffering_positions(technology).each do |position|
          %label.radio-inline{class: ('active' if position == technology.position_relative_to_buffer)}
            %input{type: 'radio', value: 'after', name: "position_relative_to_buffer_name_#{ technology.object_id }", checked: ('checked' if position == technology.position_relative_to_buffer), value: position, data: {type: 'position_relative_to_buffer'} }/
            = position.humanize

        = tooltip_tag(t(:'testing_grounds.form.position_relative_to_buffer.tooltip'))

        .clearfix

    - if technology.whitelisted?('congestion_reserve_percentage')
      .editable.battery-slider
        %span Congestion reserve
        %span.tick.min 0%
        %input.slider{data: {'slider-min' => 0, 'slider-max' => 100, 'slider-step' => 1, 'slider-value' => technology.congestion_reserve_percentage, 'type' => 'congestion_reserve_percentage'}}
        %span.tick.max 100%
        %span.tick.value
          = "#{ technology.congestion_reserve_percentage.to_i }%"
        = tooltip_tag(t(:'testing_grounds.form.congestion_reserve_percentage.tooltip'))
        .clearfix

    - if technology.whitelisted?('output_capacity')
      .editable.text{class: 'capacity'}
        %span Output capacity [kW]
        %input.form-control{type: 'text', value: technology.capacity.try(:round, 4), data: { type: 'capacity' } }
        .clearfix

    - if technology.whitelisted?('demand')
      .editable.text{class: 'demand'}
        %span Demand [kWh]
        %input.form-control{type: 'text', value: technology.demand.try(:round, 2), data: { type: 'demand'} }
        .clearfix

    - if technology.whitelisted?('input_capacity')
      .editable.text{class: 'carrier_capacity'}
        %span
          %span.tick> Input capacity (
          %span.tick.carrier>= technology.carrier
          %span.tick ) [kW]
        %input.form-control{type: 'text', value: technology.carrier_capacity.try(:round, 4), disabled: "disabled", data: { type: 'carrier_capacity' } }
        .clearfix

    - if technology.whitelisted?('volume')
      .editable.text{class: 'volume'}
        %span Volume [kWh]
        %input.form-control{type: 'text', value: technology.volume, data: { type: 'volume' }}
        .clearfix

    .editable.text.units{class: ('hidden' unless technology.whitelisted?('units'))}
      %span Units
      %input.form-control{type: 'text', value: technology.units, data: { type: 'units' }}
      .clearfix

    - InstalledTechnology.attribute_set.each do |attribute|
      - if attribute.options[:hidden] || ! technology.whitelisted?(attribute.name)
        .editable.hidden{class: attribute.name}
          %input.form-control{type: 'text', value: technology.public_send(attribute.name), data: { type: attribute.name } }

      - if attribute.options[:advanced] && technology.whitelisted?(attribute.name)
        .editable.advanced.hidden{class: attribute.name}
          %span= t(:"installed_technology_attributes.#{ attribute.name }")
          %input.form-control{type: 'text', value: technology.public_send(attribute.name), data: { type: attribute.name } }
          .clearfix

    .clearfix
  .clearfix

- if technology.associates.any?
  - technology.associates.each do |associate|
    = render partial: "technology_template", locals: { technology: associate, node: node }
