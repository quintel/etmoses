- if @profile.errors.any?
  %ul.errors
    - @profile.errors.full_messages.uniq.each do |message|
      %li= message

= form_for @profile, html: { multipart: true } do |form|
  - if @profile.new_record?
    .form-group
      = form.label :key
      = tooltip_tag(t(:'load_profiles.form.key.tooltip'))
      = form.text_field :key, class: 'form-control'
      .help-block This field is optional.

  .form-group
    = form.label :name
    = form.text_field :name, class: 'form-control'
    .help-block This field is optional.

  .form-group
    = form.label :public, "Permissions"

    .radio-buttons
      = form.radio_button :public, true
      = form.label :public, "Public", class: "radio-label"
      = form.radio_button :public, false
      = form.label :public, "Private", class: "radio-label"

  .form-group
    = form.label :load_profile_category_id
    = form.select :load_profile_category_id, load_profile_categories_select_options, {}, class: 'form-control'
    .help-block This field is optional.

  - unless @profile.locked?
    .form-group
      = form.label :curve
      = tooltip_tag(t(:'load_profiles.form.curve.tooltip'))
      = form.file_field :curve, accept: 'text/csv'

      - unless @profile.new_record?
        .help-block Leave blank if you don't want to change the curve.

  .technology-profiles-controls
    = form.label :permitted_technologies, "Permitted technologies"
    = tooltip_tag(t(:'load_profiles.form.permitted_technologies.tooltip'))
    = form.fields_for :technology_profiles do |task|
      .form-group
        .input-group.technology-profile-control
          = task.select :technology, Technology.all.map(&:name), {}, class: 'form-control'
          .input-group-addon
            = task.label :_destroy, 'Remove'
            = task.check_box :_destroy

    - tech_length = @profile.technology_profiles.length
    - 3.times do |i|
      .form-group
        = select_tag "profile[technology_profiles_attributes][#{ tech_length + i }][technology]", technologies_select_options, {class: 'form-control', prompt: "Technology Key ##{ tech_length + i + 1 } (optional)"}

    .alert.alert-info.max-permitted-notice
      Need to add more permitted technologies? Save the load profile and then
      choose to edit it again to add more.

  .form-group
    = form.submit class: 'btn btn-primary'
    %span.or or
    - if @profile.new_record?
      = link_to 'Cancel', load_profiles_path, class: 'btn btn-default'
    - else
      = link_to 'Cancel', load_profile_path(@profile), class: 'btn btn-default'
